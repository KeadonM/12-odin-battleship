!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e=[[2,"Destroyer"],[3,"Submarine"],[3,"Cruiser"],[4,"Battleship"],[5,"Carrier"]],t=(e,t,n)=>({length:e,position:t,dirVertical:n,hits:0,sunk:!1,hit(){this.hits+=1,this.isSunk()},isSunk(){this.hits===this.length&&(this.sunk=!0)}}),n=()=>({squares:[["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""]],ships:[],addShip(e,n,r){if(!this.checkValidPlacement(e,n,r))return!1;const s=t(e,n,r);return this.ships.push(s),this.placeShip(s),!0},placeShip(e){let t=e.position[0],n=e.position[1];for(let r=0;r<e.length;r++)this.squares[n][t]=e,!1===e.dirVertical?t+=1:n+=1},checkValidPlacement(e,t,n){return this.checkAreaAroundShip(e,t,n,this.checkConflictAroundSquare.bind(this))?!!this.checkBounds(e,t,n)||(console.warn("Invalid placement out of bounds"),!1):(console.warn("Invalid placement conflict"),!1)},checkBounds(e,t,n){if(n){if(t[1]+e-1>9)return!1}else if(t[0]+e-1>9)return!1;return!0},checkAreaAroundShip(e,t,n,r){let s=t[0],o=t[1];if(s<0||s>9)return!1;if(o<0||o>9)return!1;for(let a=0;a<e;a++){if(!r([s,o]))return!1;!1===n?s+=1:o+=1}return!0},checkConflictAroundSquare(e){const t=e[0],n=e[1];for(let r=-1;r<=1;r++)for(let e=-1;e<=1;e++)if(!(t-r<0||t-r>9||n-e<0||n-e>9||""===this.squares[n-e][t-r]))return console.error({x:t-r,y:n-e}),console.warn("Conflict around square"),!1;return!0},receiveAttack(e,t){const n=this.squares[t][e];return"string"==typeof n?!!this.checkValidAttack(e,t)&&(this.squares[t][e]="m","m"):"object"==typeof n&&(this.squares[t][e]="h",n.hit(),n.sunk?(this.checkAreaAroundShip(n.length,n.position,n.dirVertical,this.revealAreaAfterSunk.bind(this)),"sunk"):"h")},checkValidAttack(e,t){console.log({x:e,y:t});const n=this.squares[t][e];return"m"!==n&&"h"!==n&&"sunk"!==n},revealAreaAfterSunk(e){const t=e[0],n=e[1];this.squares[n][t]="sunk";for(let r=-1;r<=1;r++)for(let e=-1;e<=1;e++)t-r<0||t-r>9||n-e<0||n-e>9||""===this.squares[n-e][t-r]&&(this.squares[n-e][t-r]="m");return!0},shipsRemaining(){let e=this.ships.length;return this.ships.forEach((t=>{!0===t.sunk&&(e-=1)})),e}});let r;const s=e=>({name:e,gameBoard:n(),turn:!1,enemy:null,placeShip(e,t,n){return this.gameBoard.addShip(e,t,n)},takeTurn(e,t){if(!1===this.turn)return!1;const n=this.enemy.gameBoard.receiveAttack(e,t);return n&&(this.turn=!1),n}}),o=()=>{const t=s("Comp");clearInterval(r),function(){for(let n=0;n<5;n++){let r,s=e[n][0];do{const e=0!==Math.round(Math.random()),n=Math.round(9*Math.random()),o=Math.round(9*Math.random());r=t.gameBoard.addShip(s,[n,o],e)}while(!r)}}();let n=!1;function o(){const e=function(){const e=t.enemy.gameBoard.squares;for(let t=0;t<e.length;t++)for(let n=0;n<e.length;n++)if("h"===e[t][n]){const r=i([n,t],e);if(!1!==r){const s=a([n,t],r.endIndex,r.direction,e);if(!1!==s){return s[Math.floor(Math.random()*s.length)]}}}return!1}();if(!1!==e)return e;return[Math.round(10*Math.random()),Math.round(10*Math.random())]}function a(e,t,n,r){if(function(e,t){const n=e[0],r=e[1],s=t[0],o=t[1];return s+o-(n+r)}(e,t)>=4)return!1;const s=e[0],o=e[1],a=t[0],i=t[1],c=[];return"x"!==n&&null!==n||("m"!==r[o][s-1]&&c.push([s-1,o]),"m"!==r[i][a+1]&&c.push([a+1,i])),"y"!==n&&null!==n||(o-1!=-1&&"m"!==r[o-1][s]&&"h"!==r[o-1][s]&&c.push([s,o-1]),i+1!==10&&"m"!==r[i+1][a]&&"h"!==r[i+1][a]&&c.push([a,i+1])),0!==c.length&&c}function i(e,t){const n=e[0],r=e[1];if(!function(e,t,n){return 0===t||"h"!==n[t][e-1]&&"h"!==n[t-1][e]}(n,r,t))return!1;let s=[],o=[];for(let i=0;i<5;i++)n+i<=9&&("h"!==t[r][n+i]||0!==i&&"h"!==t[r][n+i-1]||(s=[n+i,r])),r+i<=9&&("h"!==t[r+i][n]||0!==i&&"h"!==t[r+i-1][n]||(o=[n,r+i]));const a=function(e,t,n,r){const s=e+t,o=n[0]+n[1],a=r[0]+r[1];if(o-a==0)return null;if(s-a==0)return"x";if(s-o==0)return"y";return null}(n,r,s,o);switch(a){case"x":return{endIndex:s,direction:a};case"y":return{endIndex:o,direction:a};default:return{endIndex:e,direction:a}}}return r=setInterval((()=>{n||(!function(){if(!t.turn)return;const[e,r]=o();if(!1===t.enemy.gameBoard.checkValidAttack(e,r))return;n=!0,setTimeout((()=>{const s=document.querySelector(`.${t.enemy.name}[data-xy="${e},${r}"]`);null!==s&&s.click(),n=!1}),1e3)}(),console.warn("comp loop"))}),1),Object.assign(t,{chooseMove:o})},a=document.querySelector(".mock.ship");let i=!0,c={dir:!1,length:0,name:"default"};function l(e,t,n){c.dir=t,c.length=e[0],c.name=e[1],null!==n.dataTransfer&&null!==a&&n.dataTransfer.setDragImage(a,25,25)}function u(e){if((e.shiftKey||3===e.buttons)&&i){c.dir=!c.dir,i=!1;document.querySelectorAll(".drop-hover").forEach((e=>{e.classList.remove("drop-hover"),e.classList.remove("invalid")}))}e.shiftKey||3===e.buttons||(i=!0)}const d=e=>{const t=e.gameBoard,n=document.createElement("div");n.className="squares-wrapper";for(let r=0;r<t.squares.length;r++)for(let s=0;s<t.squares.length;s++){const o=document.createElement("div");n.appendChild(o),o.className=`${e.name} square`,o.setAttribute("data-xy",`${s},${r}`),o.addEventListener("click",(()=>h(o,e,s,r))),"Comp"!==e.name&&m(o,s,r,e);const a=t.squares[r][s];switch("object"==typeof a&&"Comp"!==e.name&&o.classList.add("placed-ship"),a){case"m":o.classList.add("miss");break;case"h":o.classList.add("hit");break;case"sunk":o.classList.add("sunk")}}return n};function h(e,t,n,r){if(!1===t.enemy.turn)return;switch(t.enemy.takeTurn(n,r)){case"m":e.classList.add("miss");break;case"h":e.classList.add("hit");break;case"sunk":g(t)}}function m(e,t,n,r){e.addEventListener("drop",(s=>{!function(e,t,n,r){var s;if(null!=r.dataTransfer){if(n.placeShip(c.length,[e,t],c.dir)){const e=document.querySelector(`#${c.name}`);if(null!==e&&(null==(s=document.querySelector(".ships-wrapper"))||s.removeChild(e)),5===n.gameBoard.shipsRemaining()){document.querySelector(".instructions").textContent="";document.querySelector(".start-button").disabled=!1}}g(n)}else console.warn("No data transfer")}(t,n,r,s),e.classList.remove("drop-hover")})),e.addEventListener("dragleave",(()=>{for(let e=0;e<c.length;e++){const s=!1===c.dir?{x:t+e,y:n}:{x:t,y:n+e},o=document.querySelector(`.${r.name}[data-xy="${s.x},${s.y}"]`);null==o||o.classList.remove("drop-hover"),null==o||o.classList.remove("invalid")}})),e.addEventListener("dragover",(e=>{e.preventDefault();const s=r.gameBoard.checkValidPlacement(c.length,[t,n],c.dir);for(let o=0;o<c.length;o++){const e=!1===c.dir?{x:t+o,y:n}:{x:t,y:n+o},a=document.querySelector(`.${r.name}[data-xy="${e.x},${e.y}"]`);setTimeout((()=>{null==a||a.classList.add("drop-hover")}),0),s||null==a||a.classList.add("invalid")}}))}const p=(t,n)=>{const r=document.getElementById("app");if(!r)return console.error("App element not found");r.appendChild(function(){const e=document.createElement("div");e.className="controls-wrapper";const t=document.createElement("button");t.className="start-button",t.textContent="Start",t.disabled=!0,t.onclick=()=>{!function(){0===Math.round(Math.random())?q.turn=!0:S.turn=!0;C=!0===q.turn?q:S,y(C),b=!1}(),t.disabled=!0},e.appendChild(t);const n=document.createElement("button");return n.className="reset-button",n.textContent="Reset",n.onclick=()=>{document.getElementById("app").innerHTML="",[q,S]=L(),C=null,b=!0,x(),clearInterval(k)},e.appendChild(n),e}());const s=document.createElement("div");s.className="game",r.appendChild(s);const o=f(t);o.appendChild((()=>{const t=document.createElement("div");t.className="ships-wrapper";for(let n=4;n>=0;n--){const r=document.createElement("div");t.appendChild(r),r.className="ship horizontal",r.id=e[n][1],r.setAttribute("draggable","true");let s=!1;r.addEventListener("click",(()=>{s=!s,r.classList.toggle("horizontal")})),r.addEventListener("dragstart",(t=>{l(e[n],s,t)})),r.addEventListener("drag",(e=>{u(e)}));for(let t=0;t<e[n][0];t++){const e=document.createElement("div");r.appendChild(e)}}return t})());const a=document.createElement("div");a.className="instructions",a.textContent="Shift or right click to change directions.",o.appendChild(a),s.appendChild(o);const i=f(n);s.appendChild(i)};function f(e){const t=document.createElement("div");t.className=`${e.name} game-ui`;const n=document.createElement("p");n.className="player-name",n.textContent=e.name,t.appendChild(n);const r=document.createElement("div");return r.className=`game-board ${e.name}`,r.appendChild(d(e)),t.appendChild(r),t}const g=e=>{console.log(`.game-board .${e.name}`);const t=document.querySelector(`.game-board.${e.name}`);if(!t)return console.error("Board element not found");t.innerHTML="",t.appendChild(d(e))},y=e=>{document.querySelectorAll(".game-ui").forEach((e=>{e.classList.remove("active")}));const t=document.querySelector(`.${e.name}.game-ui`);null==t||t.classList.add("active")},v=(e,t)=>{const n=document.querySelector(`.game-ui.${e.name}`),r=document.querySelector(`.game-ui.${t.name}`);n.firstChild.textContent=e.name+" Loses...",r.firstChild.textContent=t.name+" Wins!"};let k,[q,S]=L(),C=null,b=!0;function L(){const e=s("Human"),t=o();return e.enemy=t,t.enemy=e,p(e,t),[e,t]}function x(){k=setInterval((()=>{!0===(null==C?void 0:C.turn)||b||(C=C===q?S:q,C.turn=!0,y(C),b=function(e){if(0===e.gameBoard.shipsRemaining())return v(e,e.enemy),!0;return!1}(C))}),30)}x();
